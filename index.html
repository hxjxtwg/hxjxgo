<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人导航</title>
    <link rel="icon" href="/logo.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-title">
                    <img src="/my-logo.svg" alt="网站Logo" class="header-logo">
                    <h1>我的导航</h1>
                </div>
                <div class="theme-switcher">
                    <input type="checkbox" id="theme-toggle">
                    <label for="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="#">首页</a></li>
                    <li><a href="https://bg.363689.xyz">博客</a></li>
                    <li><a href="#">项目</a></li>
                    <li><a href="#">关于我</a></li>
                </ul>
            </nav>
        </header>
        <main id="links-container">
            <!-- 链接将由JS动态加载 -->
        </main>
    </div>

    <script>
        const linksContainer = document.getElementById('links-container');
        const themeToggle = document.getElementById('theme-toggle');

        // --- Theme Switcher Logic ---
        function applyTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                themeToggle.checked = true;
            } else {
                document.body.classList.remove('light-mode');
                themeToggle.checked = false;
            }
        }

        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                localStorage.setItem('theme', 'light');
                applyTheme('light');
            } else {
                localStorage.setItem('theme', 'dark');
                applyTheme('dark');
            }
        });

        // Apply saved theme on page load
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
        // --- End of Theme Switcher Logic ---


        const defaultColors = [
            "#bb86fc", "#03dac6", "#cf6679", "#448aff",
            "#ff9800", "#4caf50", "#f44336", "#00bcd4"
        ];
        let colorIndex = 0;

        async function loadLinks() {
            try {
                const response = await fetch('/api/links');
                if (!response.ok) {
                    throw new Error('网络响应错误');
                }
                const linkGroups = await response.json();

                if (!linkGroups || linkGroups.length === 0) {
                    linksContainer.innerHTML = '<p class="placeholder">暂无数据，请先前往后台添加。</p>';
                    return;
                }

                linksContainer.innerHTML = ''; 

                linkGroups.forEach(group => {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'link-group';

                    const title = document.createElement('h2');
                    title.className = 'card-group-title';
                    title.textContent = group.title;
                    groupDiv.appendChild(title);

                    const cardList = document.createElement('ul');
                    
                    if(Array.isArray(group.links)) {
                        group.links.forEach(link => {
                            const cardItem = document.createElement('li');
                            const linkElement = document.createElement('a');
                            linkElement.href = link.url;
                            linkElement.target = '_blank';
                            linkElement.rel = 'noopener noreferrer';
                            
                            const cardColor = link.color || defaultColors[colorIndex % defaultColors.length];
                            linkElement.style.backgroundColor = cardColor;
                            colorIndex++;
                            
                            const iconUrl = link.icon || `https://www.google.com/s2/favicons?domain=${new URL(link.url).hostname}&sz=32`;
                            
                            linkElement.innerHTML = `
                                <img src="${iconUrl}" alt="${link.name} icon" class="card-icon" onerror="this.style.display='none'">
                                <span class="card-name">${link.name}</span>
                            `;
                            
                            cardItem.appendChild(linkElement);
                            cardList.appendChild(cardItem);
                        });
                    }
                    
                    groupDiv.appendChild(cardList);
                    linksContainer.appendChild(groupDiv);
                });
            } catch (error) {
                console.error('加载链接失败:', error);
                linksContainer.innerHTML = '<p class="placeholder error">加载数据失败，请检查网络或后台配置。</p>';
            }
        }

        loadLinks();
    </script>
</body>
</html>

