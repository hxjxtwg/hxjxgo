<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导航</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>我的导航</h1>
            <p>一个简洁、快速的个人导航页面。</p>
        </header>
        
        <nav class="main-nav">
            <ul>
                <li><a href="#">首页</a></li>
                <li><a href="#">博客</a></li>
                <li><a href="#">项目</a></li>
                <li><a href="#">关于我</a></li>
            </ul>
        </nav>

        <main id="links-container">
            <p class="loading">正在从云端加载链接...</p>
        </main>
    </div>

    <script>
        const linksContainer = document.getElementById('links-container');
        
        const colorPalette = [
            '#5E35B1', '#3949AB', '#1E88E5', '#00ACC1', '#00897B',
            '#43A047', '#F4511E', '#D81B60', '#8E24AA', '#546E7A'
        ];
        let colorIndex = 0;

        function createLinkGroups(linkGroups) {
            linksContainer.innerHTML = '';
            linkGroups.forEach(group => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'link-group';

                const title = document.createElement('h2');
                title.textContent = group.title;
                groupDiv.appendChild(title);

                const ul = document.createElement('ul');
                group.links.forEach(link => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.target = "_blank";
                    a.rel = "noopener noreferrer";

                    // --- 核心改动：创建并添加图标 ---
                    const img = document.createElement('img');
                    img.className = 'favicon';
                    // 优先使用自定义图标
                    if (link.icon && link.icon.trim() !== '') {
                        img.src = link.icon;
                    } else {
                         // 否则，尝试通过URL获取
                        try {
                           const domain = new URL(link.url).hostname;
                           img.src = `https://www.google.com/s2/favicons?sz=64&domain=${domain}`;
                        } catch (e) {
                           img.style.display = 'none'; // 如果URL格式不正确，则隐藏图标
                        }
                    }
                    // 如果图标加载失败，则隐藏它
                    img.onerror = () => { img.style.display = 'none'; };
                    a.appendChild(img);

                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = link.name;
                    a.appendChild(nameSpan);

                    if (link.color && /^#[0-9A-F]{6}$/i.test(link.color)) {
                        a.style.backgroundColor = link.color;
                    } else {
                        a.style.backgroundColor = colorPalette[colorIndex % colorPalette.length];
                        colorIndex++;
                    }
                    
                    li.appendChild(a);
                    ul.appendChild(li);
                });
                groupDiv.appendChild(ul);
                linksContainer.appendChild(groupDiv);
            });
        }

        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/api/links');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const linkGroups = await response.json();
                createLinkGroups(linkGroups);
            } catch (error) {
                console.error("加载链接失败:", error);
                linksContainer.innerHTML = '<p class="error">加载链接失败，请检查后台配置或网络连接。</p>';
            }
        });
    </script>
</body>
</html>

