<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人导航</title>
    <link rel="icon" href="/my-logo.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-title">
                    <div class="header-logo"></div>
                    <h1>我的导航</h1>
                </div>
                <div class="theme-switcher">
                    <input type="checkbox" id="theme-toggle">
                    <label for="theme-toggle">
                        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    </label>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="#">首页</a></li>
                    <li><a href="#">博客</a></li>
                    <li><a href="#">项目</a></li>
                    <li><a href="#">关于我</a></li>
                </ul>
            </nav>
        </header>
        <main id="links-container">
            <!-- 链接将由JS动态加载 -->
        </main>
    </div>

    <script>
        const linksContainer = document.getElementById('links-container');
        const themeToggle = document.getElementById('theme-toggle');

        // --- Theme Switcher Logic ---
        function applyTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                themeToggle.checked = true;
            } else {
                document.body.classList.remove('light-mode');
                themeToggle.checked = false;
            }
        }

        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                localStorage.setItem('theme', 'light');
                applyTheme('light');
            } else {
                localStorage.setItem('theme', 'dark');
                applyTheme('dark');
            }
        });

        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
        // --- End of Theme Switcher Logic ---

        // 新增：将HEX颜色转换为带有透明度的RGBA颜色
        function hexToRgba(hex, alpha) {
            let r = 0, g = 0, b = 0;
            if (hex.length === 4) {
                r = "0x" + hex[1] + hex[1];
                g = "0x" + hex[2] + hex[2];
                b = "0x" + hex[3] + hex[3];
            } else if (hex.length === 7) {
                r = "0x" + hex[1] + hex[2];
                g = "0x" + hex[3] + hex[4];
                b = "0x" + hex[5] + hex[6];
            }
            return `rgba(${+r}, ${+g}, ${+b}, ${alpha})`;
        }


        const defaultColors = [
            "#bb86fc", "#03dac6", "#cf6679", "#448aff",
            "#ff9800", "#4caf50", "#f44336", "#00bcd4"
        ];
        let colorIndex = 0;

        async function loadLinks() {
            try {
                const response = await fetch('/api/links');
                if (!response.ok) {
                    throw new Error('网络响应错误');
                }
                const linkGroups = await response.json();

                if (!linkGroups || linkGroups.length === 0) {
                    linksContainer.innerHTML = '<p class="placeholder">暂无数据，请先前往后台添加。</p>';
                    return;
                }

                linksContainer.innerHTML = ''; 

                linkGroups.forEach(group => {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'link-group';

                    const title = document.createElement('h2');
                    title.className = 'card-group-title';
                    title.textContent = group.title;
                    groupDiv.appendChild(title);

                    const cardList = document.createElement('ul');
                    
                    if(Array.isArray(group.links)) {
                        group.links.forEach(link => {
                            const cardItem = document.createElement('li');
                            const linkElement = document.createElement('a');
                            linkElement.href = link.url;
                            linkElement.target = '_blank';
                            linkElement.rel = 'noopener noreferrer';
                            
                            const cardColor = link.color || defaultColors[colorIndex % defaultColors.length];
                            // 更新：使用转换后的半透明颜色
                            linkElement.style.backgroundColor = hexToRgba(cardColor, 0.2);
                            colorIndex++;
                            
                            const iconUrl = link.icon || `https://www.google.com/s2/favicons?domain=${new URL(link.url).hostname}&sz=32`;
                            
                            linkElement.innerHTML = `
                                <div class="card-icon" style="background-image: url('${iconUrl}')"></div>
                                <span class="card-name">${link.name}</span>
                            `;
                            
                            cardItem.appendChild(linkElement);
                            cardList.appendChild(cardItem);
                        });
                    }
                    
                    groupDiv.appendChild(cardList);
                    linksContainer.appendChild(groupDiv);
                });
            } catch (error) {
                console.error('加载链接失败:', error);
                linksContainer.innerHTML = '<p class="placeholder error">加载数据失败，请检查网络或后台配置。</p>';
            }
        }

        loadLinks();
    </script>
</body>
</html>

